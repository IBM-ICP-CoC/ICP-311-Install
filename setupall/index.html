<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Setup on All VMs - Installing IBM Cloud Private</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Setup on All VMs";
    var mkdocs_page_input_path = "setupall.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Installing IBM Cloud Private</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../createvms/">Creating VMs</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Setup on All VMs</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#setup-on-all-machines">Setup on All Machines</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#install-prerequisites">Install Prerequisites</a></li>
        
            <li><a class="toctree-l3" href="#modify-the-disks">Modify the disks</a></li>
        
            <li><a class="toctree-l3" href="#install-docker">Install Docker</a></li>
        
            <li><a class="toctree-l3" href="#disable-the-firewall">Disable the firewall</a></li>
        
            <li><a class="toctree-l3" href="#rename-the-virtual-machine">Rename the virtual machine</a></li>
        
            <li><a class="toctree-l3" href="#update-the-hosts-file">Update the hosts file</a></li>
        
            <li><a class="toctree-l3" href="#setup-ssh-keys">Setup SSH keys</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installicp/">Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../customurl/">Using a custom URL</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../ldap/">Installing and Configuring LDAP</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Installing IBM Cloud Private</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Setup on All VMs</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/IBM-ICP-CoC/ICP-311-Install/edit/master/docs/setupall.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="setup-on-all-machines">Setup on All Machines</h1>
<p>To install IBM Cloud Private you first need to prepare all of your virtual machines.  These instructions are specific to the install being done, and were derived from the <a href="https://www.ibm.com/support/knowledgecenter/en/SSBS6K_3.1.1/installing/prep.html">Preparing your cluster for installation</a> section of the ICP Knowledge Center. They are not reflective of all the steps necessary in all situations.  </p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There are two scripts that will help you prapare your virtual machines for installation of ICP.<br />
<a href="../files/modify_fs_v2.sh">modify_fs_v2.sh</a> will prepare the disks and move the <code>/var</code> and <code>/opt</code> directories to the two additional disks provisioned when the VMs were created.<br />
<a href="../files/install_prereqs.sh">install_prereqs.sh</a> takes care of installing MOST of what you will need for the prerequisites.
I would encourage you to look at the contents of these scripts to understand what they do. It should also be noted that they are specific to RHEL, so if your using another OS, such as Ubuntu you will have to perform these steps manually using the proper os commands. </p>
</div>
<div class="admonition new">
<p class="admonition-title">New</p>
<p>We have added an additional script to the repo that will expand the <code>/var</code> directory only. We have found that the space requirements for v3.1.1 have changed from previous the version. For this reason, we have a 3rd script you can choose to use if you only want to increase the size of the <code>/var</code> directory. 
<a href="../files/modify_fs_v3.sh">modify_fs_v3.sh</a> will prepare the disk and move the <code>/var</code> directorie to the additional disk provisioned when the VMs were created.  </p>
</div>
<h2 id="install-prerequisites">Install Prerequisites</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first time you make a secure connection to a remote machine you may see this message:</p>
<blockquote>
<p>The authenticity of host '169.60.185.59 (169.60.185.59)' can't be established.
ECDSA key fingerprint is SHA256:XAs372uCWTkOqLOkXwQYuCXq21GaJFoYIuItUf0xGpc.
Are you sure you want to continue connecting (yes/no)?</p>
</blockquote>
<p>Type in <code>yes</code> and the key fingerprint will be added to your <code>~/.ssh/known_hosts</code> file.</p>
</div>
<ul>
<li>Download <a href="../files/install_prereqs.sh">install_prereqs.sh</a> and use <code>scp</code> to transfer it to the virtual machine.</li>
<li>Inside of the virtual machine use this command to change the permissions: <code>chmod 777 install_prereqs.sh</code></li>
<li>Execute the script: <code>./install_prereqs.sh</code></li>
</ul>
<h2 id="modify-the-disks">Modify the disks</h2>
<p>When the virtual machine was created two additional disks were added to the configuration, but they are not yet configured inside the virtual machine.  These two disks are to be used for the <code>/opt</code> and <code>/var</code> directories.  </p>
<ul>
<li>Download <a href="../files/modify_fs_v2.sh">modify_fs_v2.sh</a> and use <code>scp</code> to transfer it to the virtual machine.</li>
<li>
<p>Inside of the virtual machine use this command to change permissions: </p>
<p><code>chmod 777 modify_fs_v2.sh</code></p>
</li>
<li>
<p>Execute the script: </p>
<p><code>./modify_fs_v2.sh 199 499</code> &lt;--- The parameters correspond to the sizes of <code>Disk 1</code> and <code>Disk 2</code> (minus 1)</p>
</li>
</ul>
<h2 id="install-docker">Install Docker</h2>
<ul>
<li>SCP copy the docker file (This is the IBM Docker Enterprise version) to your local machine
    (icp-docker-18.03.1_x86_64.bin is available with the download of ICP 3.1.1 EE)</li>
<li>From your local machine you need to SCP transfer the file to each ICP server</li>
<li>
<p>Make an install dir on server (In this example I created the install dir on the root dir)</p>
<p><code>mkdir install</code></p>
<p><code>chmod dir 777 install</code></p>
</li>
<li>
<p>Open Terminal window on local machine</p>
</li>
<li>Navigate to dir where file is located</li>
<li>
<p>scp command:    </p>
<p><code>scp ./icp-docker-18.03.1_x86_64.bin login@icp-server-ip:/install/</code></p>
</li>
</ul>
<p>On the server you should now see the docker file. </p>
<h3 id="docker-install-commands">Docker install commands</h3>
<pre><code>    chmod 777 on the file
    ./icp-docker-18.03.1_x86_64.bin --install

    systemctl start docker
    systemctl enable docker
</code></pre>

<h2 id="disable-the-firewall">Disable the firewall</h2>
<pre><code>systemctl disable firewalld
systemctl stop firewalld
</code></pre>

<h2 id="rename-the-virtual-machine">Rename the virtual machine</h2>
<pre><code>hostnamectl set-hostname &lt;new name&gt;
</code></pre>

<h2 id="update-the-hosts-file">Update the hosts file</h2>
<p>Make sure that the <code>/etc/hosts</code> file on each virtual machine has entries for all of the other virtual machines so that they can talk to each other. Take note of what your host names are, you will need them in the following steps. </p>
<h2 id="setup-ssh-keys">Setup SSH keys</h2>
<h3 id="generate-the-key-on-each-node">Generate the KEY on each node</h3>
<pre><code>cd /root ;ssh-keygen -b 4096 -f /root/.ssh/id_rsa -N &quot;&quot; ;cat ~/.ssh/id_rsa.pub | sudo tee -a ~/.ssh/authorized_keys
</code></pre>

<h3 id="copy-the-key-to-each-of-the-other-nodes">Copy the key to each of the other nodes</h3>
<p><strong>DO NOT</strong> just copy these commands below, they are for example ONLY. You need to edit the host names at the end of each of these commands. You will need to run ALL of these commands to copy the SSH key from the current VM to all the rest of the VM's in the cluster. We are sharing the SSH keys, so that the install script can SSH into the other boxes without authentication. </p>
<pre><code>ssh-copy-id -i .ssh/id_rsa.pub root@dak311master

ssh-copy-id -i .ssh/id_rsa.pub root@dak311mgmt

ssh-copy-id -i .ssh/id_rsa.pub root@dak311va

ssh-copy-id -i .ssh/id_rsa.pub root@dak311worker1

ssh-copy-id -i .ssh/id_rsa.pub root@dak311worker2
</code></pre>

<h3 id="test-the-ssh-keys">Test the SSH keys</h3>
<p>You can perform a simple test to ensure that the SSH keys are setup correctly. At this point you should be able to SSH into any one of the VM's from any one of the VM's. Try it out and spot check the SSH keys. </p>
<p>As an example:  I am logged into the master node. I should be able to type this command below and log directly into the worker1 node without any authentication propts. The example below assumes the host name for worker1 is dak311worker1, yours may be different. </p>
<pre><code>ssh dak311worker1
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should now see that your logged into the worker 1 node and you didn't see any prompts for userid or password.</p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../installicp/" class="btn btn-neutral float-right" title="Installation">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../createvms/" class="btn btn-neutral" title="Creating VMs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/IBM-ICP-CoC/ICP-311-Install/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../createvms/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../installicp/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
